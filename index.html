<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BrawlCity Rank</title>
<link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&family=Barlow:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#060608;--bg2:#0a0a0f;--surface:#0f0f18;--surface2:#141420;
  --border:rgba(255,255,255,0.06);--gold:#FFD000;--gold2:#FF9500;
  --silver:#A8B8C8;--bronze:#C87840;--accent:#00C8FF;
  --green:#00FF88;--red:#FF3355;--text:#D8D8E8;
  --text-dim:rgba(216,216,232,0.45);--text-muted:rgba(216,216,232,0.22);
  --pe:#FF4400;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Barlow',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,200,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,200,255,0.025) 1px,transparent 1px);background-size:50px 50px;pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 35% at 50% 0%,rgba(0,120,255,0.07) 0%,transparent 70%),radial-gradient(ellipse 40% 25% at 90% 90%,rgba(255,208,0,0.04) 0%,transparent 60%);pointer-events:none;z-index:0;}
header{position:relative;z-index:10;padding:36px 20px 18px;text-align:center;border-bottom:1px solid var(--border);}
.logo{font-family:'Teko',sans-serif;font-size:clamp(3.5rem,13vw,7rem);font-weight:700;letter-spacing:6px;line-height:0.9;background:linear-gradient(180deg,#fff 0%,var(--gold) 55%,var(--gold2) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 40px rgba(255,208,0,0.25));animation:logoIn 0.8s cubic-bezier(.16,1,.3,1) both;}
@keyframes logoIn{from{transform:translateY(-15px);opacity:0}to{transform:translateY(0);opacity:1}}
.logo-sub{font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:5px;color:var(--accent);text-transform:uppercase;opacity:0.7;margin-top:4px;}
.live-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(0,255,136,0.07);border:1px solid rgba(0,255,136,0.18);border-radius:3px;padding:3px 10px;font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--green);letter-spacing:3px;margin-top:10px;}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;box-shadow:0 0 8px var(--green);animation:blink 1.2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.tab-bar{position:relative;z-index:10;display:flex;max-width:780px;margin:0 auto;padding:16px 16px 0;gap:4px;}
.tab-btn{flex:1;background:var(--surface);border:1px solid var(--border);border-bottom:none;color:var(--text-dim);padding:10px 16px;font-family:'Teko',sans-serif;font-size:1.1rem;letter-spacing:2px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;border-radius:4px 4px 0 0;}
.tab-btn:hover{color:var(--text);background:var(--surface2);}
.tab-btn.active{background:var(--surface2);border-color:rgba(0,200,255,0.2);color:var(--accent);border-bottom:2px solid var(--accent);}
.tab-btn.pe-tab.active{color:var(--pe);border-bottom-color:var(--pe);border-color:rgba(255,68,0,0.2);}
.city-bar{position:relative;z-index:10;display:flex;gap:6px;padding:14px 16px 0;overflow-x:auto;scrollbar-width:none;max-width:780px;margin:0 auto;}
.city-bar::-webkit-scrollbar{display:none;}
.city-btn{flex-shrink:0;background:var(--surface);border:1px solid var(--border);color:var(--text-dim);padding:6px 14px;border-radius:3px;font-family:'Barlow',sans-serif;font-weight:700;font-size:0.78rem;cursor:pointer;transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
.city-btn:hover,.city-btn.active{background:rgba(255,208,0,0.08);border-color:var(--gold);color:var(--gold);}
main{position:relative;z-index:10;max-width:780px;margin:0 auto;padding:16px 16px 80px;background:var(--surface2);border:1px solid var(--border);border-top:none;border-radius:0 0 4px 4px;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.register-card{background:var(--surface);border:1px solid var(--border);border-top:2px solid var(--accent);border-radius:4px;padding:22px;margin-bottom:24px;}
.section-label{font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:10px;}
.section-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,200,255,0.2),transparent);}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-grid .full{grid-column:1/-1;}
.input-wrap{display:flex;flex-direction:column;gap:4px;}
.input-wrap label{font-size:0.62rem;font-weight:700;letter-spacing:2px;color:var(--text-muted);text-transform:uppercase;}
.input-wrap input,.input-wrap select{background:var(--bg2);border:1px solid var(--border);border-radius:3px;color:var(--text);font-family:'Barlow',sans-serif;font-size:0.95rem;font-weight:600;padding:10px 12px;outline:none;transition:all 0.2s;width:100%;}
.input-wrap input::placeholder{color:var(--text-muted);}
.input-wrap input:focus,.input-wrap select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,200,255,0.07);}
.input-wrap select option{background:#0a0a0f;}
.hint{font-size:0.63rem;color:var(--text-muted);font-weight:500;margin-top:2px;}
.hint a{color:var(--accent);text-decoration:none;}
.btn-register{background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;border-radius:3px;color:#000;font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:3px;padding:11px 24px;cursor:pointer;transition:all 0.2s;width:100%;font-weight:600;}
.btn-register:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(255,208,0,0.25);}
.btn-register:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
.toast{display:none;padding:10px 14px;border-radius:3px;margin-top:12px;font-size:0.85rem;font-weight:700;animation:toastIn 0.3s ease;}
.toast.success{display:block;background:rgba(0,255,136,0.08);border:1px solid rgba(0,255,136,0.25);color:var(--green);}
.toast.error{display:block;background:rgba(255,51,85,0.08);border:1px solid rgba(255,51,85,0.25);color:var(--red);}
.toast.info{display:block;background:rgba(0,200,255,0.08);border:1px solid rgba(0,200,255,0.25);color:var(--accent);}
@keyframes toastIn{from{transform:translateY(-6px);opacity:0}to{transform:translateY(0);opacity:1}}
.ranking-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.ranking-title{font-family:'Teko',sans-serif;font-size:1.5rem;letter-spacing:3px;display:flex;align-items:center;gap:10px;}
.city-pill{font-family:'JetBrains Mono',monospace;font-size:0.58rem;background:rgba(0,200,255,0.08);border:1px solid rgba(0,200,255,0.2);color:var(--accent);padding:3px 8px;border-radius:2px;letter-spacing:1px;}
.pe-pill{font-family:'JetBrains Mono',monospace;font-size:0.58rem;background:rgba(255,68,0,0.08);border:1px solid rgba(255,68,0,0.2);color:var(--pe);padding:3px 8px;border-radius:2px;letter-spacing:1px;}
.update-info{font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--text-muted);letter-spacing:1px;}
.player-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:13px 16px;margin-bottom:7px;display:flex;align-items:center;gap:14px;transition:all 0.18s;animation:cardIn 0.35s ease both;position:relative;overflow:hidden;}
.player-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--border);transition:background 0.2s;}
.player-card:hover{background:var(--surface2);transform:translateX(2px);}
.player-card:hover::before{background:var(--accent);}
.player-card.top1{border-color:rgba(255,208,0,0.18);background:linear-gradient(135deg,rgba(255,208,0,0.04),var(--surface));}
.player-card.top1::before{background:var(--gold);box-shadow:0 0 12px rgba(255,208,0,0.4);}
.player-card.top2{border-color:rgba(168,184,200,0.18);}
.player-card.top2::before{background:var(--silver);}
.player-card.top3{border-color:rgba(200,120,64,0.18);}
.player-card.top3::before{background:var(--bronze);}
@keyframes cardIn{from{transform:translateX(-12px);opacity:0}to{transform:translateX(0);opacity:1}}
.rank-num{font-family:'Teko',sans-serif;font-size:1.7rem;font-weight:600;min-width:42px;text-align:center;line-height:1;}
.r1{color:var(--gold);text-shadow:0 0 16px rgba(255,208,0,0.4);}
.r2{color:var(--silver);}
.r3{color:var(--bronze);}
.rn{color:var(--text-muted);font-size:1rem;}
.player-avatar{width:42px;height:42px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;}
.player-info{flex:1;min-width:0;}
.player-name{font-weight:800;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.2;}
.player-meta{display:flex;align-items:center;gap:8px;margin-top:3px;flex-wrap:wrap;}
.player-tag{font-family:'JetBrains Mono',monospace;font-size:0.62rem;color:var(--text-muted);}
.player-city{font-size:0.68rem;color:var(--text-dim);font-weight:700;}
.verify-link{font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--accent);text-decoration:none;opacity:0.6;transition:opacity 0.2s;}
.verify-link:hover{opacity:1;}
.player-score{display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;}
.trophy-num{font-family:'Teko',sans-serif;font-size:1.45rem;font-weight:600;color:var(--gold);letter-spacing:1px;line-height:1;}
.trophy-label{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--text-muted);letter-spacing:2px;}
.crown-icon{position:absolute;top:-5px;right:12px;font-size:1rem;animation:float 2.5s ease-in-out infinite;filter:drop-shadow(0 0 6px rgba(255,208,0,0.6));}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
.shimmer{position:absolute;inset:0;background:linear-gradient(105deg,transparent 40%,rgba(255,208,0,0.03) 50%,transparent 60%);animation:sweep 4s infinite;}
@keyframes sweep{0%{transform:translateX(-100%)}100%{transform:translateX(200%)}}
.pe-banner{background:linear-gradient(135deg,rgba(255,68,0,0.08),rgba(255,208,0,0.05));border:1px solid rgba(255,68,0,0.15);border-radius:4px;padding:14px 18px;margin-bottom:18px;display:flex;align-items:center;gap:12px;}
.pe-flag{font-size:1.8rem;}
.pe-title{font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:2px;color:var(--pe);}
.pe-desc{font-size:0.72rem;color:var(--text-dim);font-weight:600;margin-top:1px;}
.empty-state,.loading-state{text-align:center;padding:60px 20px;color:var(--text-muted);}
.empty-icon{font-size:2rem;margin-bottom:10px;opacity:0.4;}
.empty-state p,.loading-state p{font-family:'JetBrains Mono',monospace;font-size:0.7rem;letter-spacing:2px;}
.info-bar{background:rgba(0,200,255,0.04);border:1px solid rgba(0,200,255,0.08);border-radius:3px;padding:10px 14px;margin-bottom:18px;font-size:0.73rem;color:var(--text-muted);font-weight:600;line-height:1.5;}
.info-bar span{color:var(--accent);}
footer{position:relative;z-index:10;text-align:center;padding:18px;font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--text-muted);letter-spacing:2px;border-top:1px solid var(--border);max-width:780px;margin:0 auto;}
@media(max-width:480px){.form-grid{grid-template-columns:1fr;}.form-grid .full{grid-column:1;}.tab-btn{font-size:0.9rem;padding:8px 10px;letter-spacing:1px;}}
</style>
</head>
<body>
<header>
  <div class="logo">BrawlCity</div>
  <div class="logo-sub">Ranking Competitivo ‚Ä¢ Pernambuco</div>
  <div class="live-badge"><span class="live-dot"></span> AO VIVO</div>
  <button id="musicBtn" onclick="toggleMusic()" style="margin-top:12px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);color:var(--text);padding:5px 14px;border-radius:3px;font-family:'Barlow',sans-serif;font-size:0.8rem;font-weight:700;cursor:pointer;letter-spacing:1px;">üîá M√öSICA</button>
</header>
<div class="tab-bar">
  <button class="tab-btn active" onclick="switchTab('cidade',this)">üèô Por Cidade</button>
  <button class="tab-btn pe-tab" onclick="switchTab('pe',this)">üèÜ Top Pernambuco</button>
</div>
<div class="city-bar" id="cityBar"></div>
<main>
  <div class="tab-content active" id="tab-cidade">
    <div class="info-bar">üõ° <span>Anti-trapa√ßa:</span> TAG + trof√©us obrigat√≥rios. Verific√°vel em brawlify.com. Dados salvos online em tempo real. üåê</div>
    <div class="register-card">
      <div class="section-label">Entrar no Ranking</div>
      <div class="form-grid">
        <div class="input-wrap"><label>Nome no Jogo</label><input type="text" id="inputName" placeholder="KingBrawler" maxlength="20"></div>
        <div class="input-wrap"><label>TAG do Brawl Stars</label><input type="text" id="inputTag" placeholder="#JQ2UUJLP" maxlength="15"></div>
        <div class="input-wrap"><label>Trof√©us Atuais üèÜ</label><input type="number" id="inputTrophies" placeholder="37837" min="0"><div class="hint">Verific√°vel em <a href="https://brawlify.com" target="_blank">brawlify.com</a></div></div>
        <div class="input-wrap"><label>Cidade</label><select id="inputCity"></select></div>
        <div class="input-wrap full"><button class="btn-register" id="btnRegister" onclick="register()">ENTRAR NO RANKING</button></div>
      </div>
      <div class="toast" id="toast"></div>
    </div>
    <div class="ranking-header">
      <div class="ranking-title">TOP <span class="city-pill" id="activeCityTag">AGRESTINA-PE</span></div>
      <div class="update-info" id="updateInfo">CONECTANDO...</div>
    </div>
    <div id="rankingList"><div class="loading-state"><div class="empty-icon">‚è≥</div><p>CARREGANDO...</p></div></div>
  </div>
  <div class="tab-content" id="tab-pe">
    <div class="pe-banner">
      <div class="pe-flag">ü¶Å</div>
      <div><div class="pe-title">TOP PERNAMBUCO</div><div class="pe-desc">Os melhores jogadores de todo o estado ‚Äî todas as cidades</div></div>
    </div>
    <div class="ranking-header">
      <div class="ranking-title">RANKING <span class="pe-pill">PERNAMBUCO</span></div>
      <div class="update-info" id="updateInfoPE">AO VIVO</div>
    </div>
    <div id="rankingListPE"><div class="loading-state"><div class="empty-icon">‚è≥</div><p>CARREGANDO...</p></div></div>
  </div>
</main>
<footer>BRAWLCITY RANK ‚Ä¢ PERNAMBUCO ‚Ä¢ VERIFIQUE EM BRAWLIFY.COM</footer>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
const firebaseConfig = {
  apiKey: "AIzaSyAi05OMG44jmNm_HUEtv9LS_wa-tBvErd8",
  authDomain: "brawlcity-rank.firebaseapp.com",
  projectId: "brawlcity-rank",
  storageBucket: "brawlcity-rank.firebasestorage.app",
  messagingSenderId: "929168855194",
  appId: "1:929168855194:web:c41092248e5863f5dc0f23"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const CITIES = ['Agrestina-PE','Altinho-PE','Cupira-PE','Caruaru-PE','Petrolina-PE','Recife-PE','Garanhuns-PE','Vit√≥ria de Santo Ant√£o-PE'];
const EMOJIS = ['ü¶Å','üêØ','ü¶ä','üê∫','ü¶Ö','üêâ','ü¶à','üêª','ü¶ù','ü¶â','üî•','‚ö°','üíé'];
const COLORS = ['#FF6B00','#7B2FBE','#00BFFF','#FF3D5A','#00E676','#FFD000','#FF69B4'];
let activeCity = 'Agrestina-PE';
let allPlayers = [];
const cityBar = document.getElementById('cityBar');
const citySelect = document.getElementById('inputCity');
CITIES.forEach(c => {
  const btn = document.createElement('button');
  btn.className = 'city-btn' + (c === activeCity ? ' active' : '');
  btn.textContent = c; btn.dataset.city = c;
  btn.onclick = () => setCity(c);
  cityBar.appendChild(btn);
  const opt = document.createElement('option');
  opt.value = c; opt.textContent = c;
  citySelect.appendChild(opt);
});
function setCity(city) {
  activeCity = city;
  document.querySelectorAll('.city-btn').forEach(b => b.classList.toggle('active', b.dataset.city === city));
  document.getElementById('activeCityTag').textContent = city.toUpperCase();
  renderRanking();
}
const q = query(collection(db, 'players'), orderBy('trophies', 'desc'));
onSnapshot(q, snapshot => {
  allPlayers = [];
  snapshot.forEach(doc => allPlayers.push({ id: doc.id, ...doc.data() }));
  renderRanking(); renderRankingPE();
  const t = new Date().toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
  document.getElementById('updateInfo').textContent = 'üü¢ ' + t;
  document.getElementById('updateInfoPE').textContent = 'üü¢ ' + t;
}, () => {
  document.getElementById('updateInfo').textContent = 'üî¥ OFFLINE';
  document.getElementById('updateInfoPE').textContent = 'üî¥ OFFLINE';
});

// Atualiza√ß√£o autom√°tica de trof√©us via BrawlAPI
async function atualizarTrofeus() {
  if (!allPlayers.length) return;
  for (const player of allPlayers) {
    try {
      const cleanTag = player.tag.replace('#', '');
      const res = await fetch('/.netlify/functions/player?tag=' + encodeURIComponent('#' + cleanTag));
      if (!res.ok) continue;
      const data = await res.json();
      const novosTrofeus = data.trophies;
      if (novosTrofeus && novosTrofeus !== player.trophies) {
        const ref = doc(db, 'players', player.id);
        await updateDoc(ref, { trophies: novosTrofeus });
      }
    } catch(e) { /* ignora erros individuais */ }
  }
}
// Atualiza 5s ap√≥s carregar e depois a cada 30 minutos
setTimeout(atualizarTrofeus, 5000);
setInterval(atualizarTrofeus, 30 * 60 * 1000);
const PALAVROES = ['vagina','pinto','pau','rola','buceta','cu','merda','porra','caralho','viado','puta','piroca','punheta','cuzao','fdp','filhadaputa','desgra√ßa','inferno','arrombado','babaca','idiota','imbecil','retardado','corno','vadia','safada','safado','canalha','lixo','burro','otario','ot√°rio','nojento','nojentoass','ass','fuck','shit','bitch','dick','cock','pussy','cunt','bastard','asshole'];
function contemPalavroes(texto) {
  const t = texto.toLowerCase().replace(/[^a-z0-9]/g,'');
  return PALAVROES.some(p => t.includes(p));
}
function tagValida(tag) {
  const semHash = tag.replace('#','');
  return /^[0289PYLQGRJCUV]{4,10}$/.test(semHash);
}
window.register = async function() {
  const btn = document.getElementById('btnRegister');
  const name = document.getElementById('inputName').value.trim();
  let tag = document.getElementById('inputTag').value.trim().toUpperCase();
  const trophiesRaw = document.getElementById('inputTrophies').value.trim();
  const city = document.getElementById('inputCity').value;
  if (!name) return showToast('Digite seu nome!', 'error');
  if (name.length < 2) return showToast('Nome muito curto!', 'error');
  if (contemPalavroes(name)) return showToast('Nome inv√°lido!', 'error');
  if (!tag) return showToast('Digite sua TAG!', 'error');
  if (!tag.startsWith('#')) tag = '#' + tag;
  if (tag.length < 4) return showToast('TAG inv√°lida!', 'error');
  if (!tagValida(tag)) return showToast('TAG inv√°lida! Use sua TAG real do Brawl Stars.', 'error');
  if (contemPalavroes(tag)) return showToast('TAG inv√°lida!', 'error');
  if (!trophiesRaw) return showToast('Digite seus trof√©us!', 'error');
  const trophies = parseInt(trophiesRaw);
  if (isNaN(trophies) || trophies < 0) return showToast('Trof√©us inv√°lido!', 'error');
  if (trophies > 10000000) return showToast('N√∫mero de trof√©us inv√°lido!', 'error');
  if (allPlayers.find(p => p.tag.toUpperCase() === tag)) return showToast('TAG j√° cadastrada!', 'error');
  btn.disabled = true; btn.textContent = 'SALVANDO...';
  try {
    await addDoc(collection(db, 'players'), { name, tag, city, trophies, emoji: EMOJIS[Math.floor(Math.random()*EMOJIS.length)], color: COLORS[Math.floor(Math.random()*COLORS.length)], joined: Date.now() });
    document.getElementById('inputName').value = '';
    document.getElementById('inputTag').value = '';
    document.getElementById('inputTrophies').value = '';
    showToast('‚úì ' + name + ' entrou com ' + trophies.toLocaleString('pt-BR') + ' trof√©us!', 'success');
    setCity(city);
  } catch(e) { showToast('Erro ao salvar. Tente novamente!', 'error'); }
  btn.disabled = false; btn.textContent = 'ENTRAR NO RANKING';
};
function showToast(msg, type='info') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast ' + type;
  clearTimeout(t._t); t._t = setTimeout(() => t.className = 'toast', 5000);
}
function buildCards(players, containerId) {
  const list = document.getElementById(containerId);
  if (!players.length) { list.innerHTML = '<div class="empty-state"><div class="empty-icon">üéÆ</div><p>NENHUM JOGADOR AINDA</p></div>'; return; }
  list.innerHTML = '';
  players.forEach((p, i) => {
    const pos = i+1;
    const topClass = pos===1?'top1':pos===2?'top2':pos===3?'top3':'';
    const rankClass = pos===1?'r1':pos===2?'r2':pos===3?'r3':'rn';
    const rankLabel = pos===1?'ü•á':pos===2?'ü•à':pos===3?'ü•â':'#'+pos;
    const cleanTag = p.tag.replace('#','');
    const card = document.createElement('div');
    card.className = 'player-card ' + topClass;
    card.style.animationDelay = (i*0.04) + 's';
    card.innerHTML = (pos===1?'<div class="crown-icon">üëë</div><div class="shimmer"></div>':'') +
      '<div class="rank-num ' + rankClass + '">' + rankLabel + '</div>' +
      '<div class="player-avatar" style="background:' + p.color + '15;border:1px solid ' + p.color + '28;">' + p.emoji + '</div>' +
      '<div class="player-info"><div class="player-name">' + p.name + '</div>' +
      '<div class="player-meta"><span class="player-tag">' + p.tag + '</span>' +
      '<span class="player-city">üìç ' + p.city + '</span>' +
      '<a class="verify-link" href="https://brawlify.com/stats/profile/' + cleanTag + '" target="_blank">‚Üó BRAWLIFY</a></div></div>' +
      '<div class="player-score"><div class="trophy-num">üèÜ ' + p.trophies.toLocaleString('pt-BR') + '</div><div class="trophy-label">TROF√âUS</div></div>';
    list.appendChild(card);
  });
}
function renderRanking() { buildCards(allPlayers.filter(p => p.city === activeCity).sort((a,b) => b.trophies-a.trophies), 'rankingList'); }
function renderRankingPE() { buildCards([...allPlayers].sort((a,b) => b.trophies-a.trophies), 'rankingListPE'); }
</script>
<audio id="bgMusic" src="song.mp3" loop preload="auto"></audio>
<script>
// Start music on first user interaction (required by browsers)
document.addEventListener('click', function startMusic() {
  const music = document.getElementById('bgMusic');
  if (music.paused) {
    music.volume = 0.4;
    music.play();
  }
  document.removeEventListener('click', startMusic);
}, { once: false });

// Music toggle button
function toggleMusic() {
  const music = document.getElementById('bgMusic');
  const btn = document.getElementById('musicBtn');
  if (music.paused) {
    music.play();
    btn.textContent = 'üîä';
  } else {
    music.pause();
    btn.textContent = 'üîá';
  }
}

function switchTab(tab, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  el.classList.add('active');
  document.getElementById('cityBar').style.display = tab==='cidade'?'flex':'none';
}
</script>
</body>
</html>
