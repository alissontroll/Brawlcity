
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BrawlCity Rank</title>
<link href="https://fonts.googleapis.com/css2?family=Teko:wght@400;500;600;700&family=Barlow:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#060608;--bg2:#0a0a0f;--surface:#0f0f18;--surface2:#141420;
  --border:rgba(255,255,255,0.06);--gold:#FFD000;--gold2:#FF9500;
  --silver:#A8B8C8;--bronze:#C87840;--accent:#00C8FF;
  --green:#00FF88;--red:#FF3355;--text:#D8D8E8;
  --text-dim:rgba(216,216,232,0.45);--text-muted:rgba(216,216,232,0.22);
  --pe:#FF4400;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Barlow',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;}
body::before{content:'';position:fixed;inset:0;background-image:linear-gradient(rgba(0,200,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,200,255,0.025) 1px,transparent 1px);background-size:50px 50px;pointer-events:none;z-index:0;}
body::after{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 70% 35% at 50% 0%,rgba(0,120,255,0.07) 0%,transparent 70%),radial-gradient(ellipse 40% 25% at 90% 90%,rgba(255,208,0,0.04) 0%,transparent 60%);pointer-events:none;z-index:0;}
header{position:relative;z-index:10;padding:36px 20px 18px;text-align:center;border-bottom:1px solid var(--border);}
.logo{font-family:'Teko',sans-serif;font-size:clamp(3.5rem,13vw,7rem);font-weight:700;letter-spacing:6px;line-height:0.9;background:linear-gradient(180deg,#fff 0%,var(--gold) 55%,var(--gold2) 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;filter:drop-shadow(0 0 40px rgba(255,208,0,0.25));animation:logoIn 0.8s cubic-bezier(.16,1,.3,1) both;}
@keyframes logoIn{from{transform:translateY(-15px);opacity:0}to{transform:translateY(0);opacity:1}}
.logo-sub{font-family:'JetBrains Mono',monospace;font-size:0.6rem;letter-spacing:5px;color:var(--accent);text-transform:uppercase;opacity:0.7;margin-top:4px;}
.live-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(0,255,136,0.07);border:1px solid rgba(0,255,136,0.18);border-radius:3px;padding:3px 10px;font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--green);letter-spacing:3px;margin-top:10px;}
.live-dot{width:5px;height:5px;background:var(--green);border-radius:50%;box-shadow:0 0 8px var(--green);animation:blink 1.2s infinite;}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.2}}
.tab-bar{position:relative;z-index:10;display:flex;max-width:780px;margin:0 auto;padding:16px 16px 0;gap:4px;}
.tab-btn{flex:1;background:var(--surface);border:1px solid var(--border);border-bottom:none;color:var(--text-dim);padding:10px 8px;font-family:'Teko',sans-serif;font-size:1rem;letter-spacing:1px;cursor:pointer;transition:all 0.2s;text-transform:uppercase;border-radius:4px 4px 0 0;}
.tab-btn:hover{color:var(--text);background:var(--surface2);}
.tab-btn.active{background:var(--surface2);border-color:rgba(0,200,255,0.2);color:var(--accent);border-bottom:2px solid var(--accent);}
.tab-btn.pe-tab.active{color:var(--pe);border-bottom-color:var(--pe);border-color:rgba(255,68,0,0.2);}
.tab-btn.map-tab.active{color:var(--green);border-bottom-color:var(--green);border-color:rgba(0,255,136,0.2);}
.city-bar{position:relative;z-index:10;display:flex;gap:6px;padding:14px 16px 0;overflow-x:auto;scrollbar-width:none;max-width:780px;margin:0 auto;}
.city-bar::-webkit-scrollbar{display:none;}
.city-btn{flex-shrink:0;background:var(--surface);border:1px solid var(--border);color:var(--text-dim);padding:6px 14px;border-radius:3px;font-family:'Barlow',sans-serif;font-weight:700;font-size:0.78rem;cursor:pointer;transition:all 0.2s;text-transform:uppercase;white-space:nowrap;}
.city-btn:hover,.city-btn.active{background:rgba(255,208,0,0.08);border-color:var(--gold);color:var(--gold);}
main{position:relative;z-index:10;max-width:780px;margin:0 auto;padding:16px 16px 80px;background:var(--surface2);border:1px solid var(--border);border-top:none;border-radius:0 0 4px 4px;}
.tab-content{display:none;}
.tab-content.active{display:block;}
.register-card{background:var(--surface);border:1px solid var(--border);border-top:2px solid var(--accent);border-radius:4px;padding:22px;margin-bottom:24px;}
.section-label{font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:3px;color:var(--accent);text-transform:uppercase;margin-bottom:16px;display:flex;align-items:center;gap:10px;}
.section-label::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,rgba(0,200,255,0.2),transparent);}
.section-label.green{color:var(--green);}
.section-label.green::after{background:linear-gradient(90deg,rgba(0,255,136,0.2),transparent);}
.form-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.form-grid .full{grid-column:1/-1;}
.input-wrap{display:flex;flex-direction:column;gap:4px;}
.input-wrap label{font-size:0.62rem;font-weight:700;letter-spacing:2px;color:var(--text-muted);text-transform:uppercase;}
.input-wrap input,.input-wrap select{background:var(--bg2);border:1px solid var(--border);border-radius:3px;color:var(--text);font-family:'Barlow',sans-serif;font-size:0.95rem;font-weight:600;padding:10px 12px;outline:none;transition:all 0.2s;width:100%;}
.input-wrap input::placeholder{color:var(--text-muted);}
.input-wrap input:focus,.input-wrap select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(0,200,255,0.07);}
.input-wrap select option{background:#0a0a0f;}
.hint{font-size:0.63rem;color:var(--text-muted);font-weight:500;margin-top:2px;}
.btn-register{background:linear-gradient(135deg,var(--gold),var(--gold2));border:none;border-radius:3px;color:#000;font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:3px;padding:11px 24px;cursor:pointer;transition:all 0.2s;width:100%;font-weight:600;}
.btn-register:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(255,208,0,0.25);}
.btn-register:disabled{opacity:0.5;cursor:not-allowed;transform:none;}
.toast{display:none;padding:10px 14px;border-radius:3px;margin-top:12px;font-size:0.85rem;font-weight:700;animation:toastIn 0.3s ease;}
.toast.success{display:block;background:rgba(0,255,136,0.08);border:1px solid rgba(0,255,136,0.25);color:var(--green);}
.toast.error{display:block;background:rgba(255,51,85,0.08);border:1px solid rgba(255,51,85,0.25);color:var(--red);}
.toast.info{display:block;background:rgba(0,200,255,0.08);border:1px solid rgba(0,200,255,0.25);color:var(--accent);}
@keyframes toastIn{from{transform:translateY(-6px);opacity:0}to{transform:translateY(0);opacity:1}}
.ranking-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;padding-bottom:10px;border-bottom:1px solid var(--border);}
.ranking-title{font-family:'Teko',sans-serif;font-size:1.5rem;letter-spacing:3px;display:flex;align-items:center;gap:10px;}
.city-pill{font-family:'JetBrains Mono',monospace;font-size:0.58rem;background:rgba(0,200,255,0.08);border:1px solid rgba(0,200,255,0.2);color:var(--accent);padding:3px 8px;border-radius:2px;letter-spacing:1px;}
.pe-pill{font-family:'JetBrains Mono',monospace;font-size:0.58rem;background:rgba(255,68,0,0.08);border:1px solid rgba(255,68,0,0.2);color:var(--pe);padding:3px 8px;border-radius:2px;letter-spacing:1px;}
.update-info{font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--text-muted);letter-spacing:1px;}
.player-card{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:13px 16px;margin-bottom:7px;display:flex;align-items:center;gap:14px;transition:all 0.18s;animation:cardIn 0.35s ease both;position:relative;overflow:hidden;}
.player-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--border);transition:background 0.2s;}
.player-card:hover{background:var(--surface2);transform:translateX(2px);}
.player-card:hover::before{background:var(--accent);}
.player-card.top1{border-color:rgba(255,208,0,0.18);background:linear-gradient(135deg,rgba(255,208,0,0.04),var(--surface));}
.player-card.top1::before{background:var(--gold);box-shadow:0 0 12px rgba(255,208,0,0.4);}
.player-card.top2{border-color:rgba(168,184,200,0.18);}
.player-card.top2::before{background:var(--silver);}
.player-card.top3{border-color:rgba(200,120,64,0.18);}
.player-card.top3::before{background:var(--bronze);}
@keyframes cardIn{from{transform:translateX(-12px);opacity:0}to{transform:translateX(0);opacity:1}}
.rank-num{font-family:'Teko',sans-serif;font-size:1.7rem;font-weight:600;min-width:42px;text-align:center;line-height:1;}
.r1{color:var(--gold);text-shadow:0 0 16px rgba(255,208,0,0.4);}
.r2{color:var(--silver);}
.r3{color:var(--bronze);}
.rn{color:var(--text-muted);font-size:1rem;}
.player-avatar{width:42px;height:42px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:1.4rem;flex-shrink:0;}
.player-info{flex:1;min-width:0;}
.player-name{font-weight:800;font-size:1rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.2;}
.player-meta{display:flex;align-items:center;gap:8px;margin-top:3px;flex-wrap:wrap;}
.player-tag{font-family:'JetBrains Mono',monospace;font-size:0.62rem;color:var(--text-muted);}
.player-city{font-size:0.68rem;color:var(--text-dim);font-weight:700;}
.verify-link{font-family:'JetBrains Mono',monospace;font-size:0.58rem;color:var(--accent);text-decoration:none;opacity:0.6;transition:opacity 0.2s;}
.verify-link:hover{opacity:1;}
.player-score{display:flex;flex-direction:column;align-items:flex-end;flex-shrink:0;gap:4px;}
.trophy-num{font-family:'Teko',sans-serif;font-size:1.45rem;font-weight:600;color:var(--gold);letter-spacing:1px;line-height:1;}
.trophy-label{font-family:'JetBrains Mono',monospace;font-size:0.52rem;color:var(--text-muted);letter-spacing:2px;}
.horas-num{font-family:'Teko',sans-serif;font-size:1rem;font-weight:600;color:var(--accent);letter-spacing:1px;line-height:1;}
.horas-label{font-family:'JetBrains Mono',monospace;font-size:0.48rem;color:var(--text-muted);letter-spacing:2px;}
.crown-icon{position:absolute;top:-5px;right:12px;font-size:1rem;animation:float 2.5s ease-in-out infinite;filter:drop-shadow(0 0 6px rgba(255,208,0,0.6));}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
.shimmer{position:absolute;inset:0;background:linear-gradient(105deg,transparent 40%,rgba(255,208,0,0.03) 50%,transparent 60%);animation:sweep 4s infinite;}
@keyframes sweep{0%{transform:translateX(-100%)}100%{transform:translateX(200%)}}
.pe-banner{background:linear-gradient(135deg,rgba(255,68,0,0.08),rgba(255,208,0,0.05));border:1px solid rgba(255,68,0,0.15);border-radius:4px;padding:14px 18px;margin-bottom:18px;display:flex;align-items:center;gap:12px;}
.pe-flag{font-size:1.8rem;}
.pe-title{font-family:'Teko',sans-serif;font-size:1.2rem;letter-spacing:2px;color:var(--pe);}
< truncated lines 104-492 >
}

window.register = async function() {
  const btn = document.getElementById('btnRegister');
  let tag = document.getElementById('inputTag').value.trim().toUpperCase();
  const city = document.getElementById('inputCity').value;
  if (!tag) return showToast('Digite sua TAG!', 'error');
  if (!tag.startsWith('#')) tag = '#' + tag;
  if (!tagValida(tag)) return showToast('TAG inv√°lida! Use sua TAG real do Brawl Stars.', 'error');
  if (allPlayers.find(p => p.tag.toUpperCase() === tag)) return showToast('TAG j√° cadastrada!', 'error');
  btn.disabled = true; btn.textContent = 'BUSCANDO...';
  showToast('üîç Buscando dados no Brawl Stars...', 'info');
  try {
    const data = await buscarJogador(tag);
    if (!data.trophies || !data.name) throw new Error('Jogador n√£o encontrado');
    const name = data.name;
    const trophies = data.trophies;
    const horas = data.horas || 0;
    const emoji = EMOJIS[Math.floor(Math.random()*EMOJIS.length)];
    const color = COLORS[Math.floor(Math.random()*COLORS.length)];
    await addDoc(collection(db, 'players'), { name, tag, city, trophies, horas, emoji, color, joined: Date.now() });
    document.getElementById('inputTag').value = '';
    showToast('‚úì ' + name + ' entrou com ' + trophies.toLocaleString('pt-BR') + ' trof√©us e ~' + horas + 'h de jogo!', 'success');
    setCity(city);
  } catch(e) {
    showToast('‚ùå ' + (e.message || 'Erro ao buscar jogador. Verifique a TAG!'), 'error');
  }
  btn.disabled = false; btn.textContent = 'ENTRAR NO RANKING';
};

function showToast(msg, type='info') {
  const t = document.getElementById('toast');
  t.textContent = msg; t.className = 'toast ' + type;
  clearTimeout(t._t); t._t = setTimeout(() => t.className = 'toast', 5000);
}

function buildCards(players, containerId) {
  const list = document.getElementById(containerId);
  if (!players.length) { list.innerHTML = '<div class="empty-state"><div class="empty-icon">üéÆ</div><p>NENHUM JOGADOR AINDA</p></div>'; return; }
  list.innerHTML = '';
  players.forEach((p, i) => {
    const pos = i+1;
    const topClass = pos===1?'top1':pos===2?'top2':pos===3?'top3':'';
    const rankClass = pos===1?'r1':pos===2?'r2':pos===3?'r3':'rn';
    const rankLabel = pos===1?'ü•á':pos===2?'ü•à':pos===3?'ü•â':'#'+pos;
    const cleanTag = p.tag.replace('#','');
    const horas = p.horas || '?';
    const card = document.createElement('div');
    card.className = 'player-card ' + topClass;
    card.style.animationDelay = (i*0.04) + 's';
    card.innerHTML = (pos===1?'<div class="crown-icon">üëë</div><div class="shimmer"></div>':'') +
      '<div class="rank-num ' + rankClass + '">' + rankLabel + '</div>' +
      '<div class="player-avatar" style="background:' + p.color + '15;border:1px solid ' + p.color + '28;">' + p.emoji + '</div>' +
      '<div class="player-info"><div class="player-name">' + p.name + '</div>' +
      '<div class="player-meta"><span class="player-tag">' + p.tag + '</span>' +
      '<span class="player-city">üìç ' + p.city + '</span>' +
      '<a class="verify-link" href="https://brawlify.com/stats/profile/' + cleanTag + '" target="_blank">‚Üó BRAWLIFY</a></div></div>' +
      '<div class="player-score">' +
      '<div class="trophy-num">üèÜ ' + p.trophies.toLocaleString('pt-BR') + '</div><div class="trophy-label">TROF√âUS</div>' +
      '<div class="horas-num">‚è± ' + horas + 'h</div><div class="horas-label">DE JOGO</div>' +
      '</div>';
    list.appendChild(card);
  });
}
function renderRanking() { buildCards(allPlayers.filter(p => p.city === activeCity).sort((a,b) => b.trophies-a.trophies), 'rankingList'); }
function renderRankingPE() { buildCards([...allPlayers].sort((a,b) => b.trophies-a.trophies), 'rankingListPE'); }

// Exp√µe fun√ß√µes globais
window.carregarMapas = carregarMapas;
</script>
<audio id="bgMusic" src="song.mp3" loop preload="auto"></audio>
<script>
document.addEventListener('click', function startMusic() {
  const music = document.getElementById('bgMusic');
  if (music.paused) { music.volume = 0.4; music.play(); }
  document.removeEventListener('click', startMusic);
}, { once: false });
function toggleMusic() {
  const music = document.getElementById('bgMusic');
  const btn = document.getElementById('musicBtn');
  if (music.paused) { music.play(); btn.textContent = 'üîä'; }
  else { music.pause(); btn.textContent = 'üîá'; }
}
function switchTab(tab, el) {
  document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('tab-'+tab).classList.add('active');
  el.classList.add('active');
  document.getElementById('cityBar').style.display = tab==='cidade'?'flex':'none';
  if (tab === 'mapas' && !window._mapaCarregado) {
    window._mapaCarregado = true;
    setTimeout(function() {
      if (typeof window.carregarMapas === 'function') {
        window.carregarMapas();
        setInterval(window.carregarMapas, 5 * 60 * 1000);
      }
    }, 300);
  }
}
</script>
</body>
</html>
